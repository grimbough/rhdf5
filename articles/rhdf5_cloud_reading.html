<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reading HDF5 Files In The Cloud • rhdf5</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Reading HDF5 Files In The Cloud">
<meta property="og:description" content="rhdf5">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rhdf5</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.41.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/rhdf5.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/practical_tips.html">**rhdf5** Practical Tips</a>
    </li>
    <li>
      <a href="../articles/rhdf5_cloud_reading.html">Reading HDF5 Files In The Cloud</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/grimbough/rhdf5/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Reading HDF5 Files In The Cloud</h1>
                        <h4 data-toc-skip class="author">Mike L. Smith</h4>
            <address class="author_afil">
      de.NBI &amp; EMBL Heidelberg<br><small class="dont-index">Source: <a href="https://github.com/grimbough/rhdf5/blob/HEAD/vignettes/rhdf5_cloud_reading.Rmd" class="external-link"><code>vignettes/rhdf5_cloud_reading.Rmd</code></a></small>
      <div class="hidden name"><code>rhdf5_cloud_reading.Rmd</code></div>

    </address>
</div>

    
    
<p>The <em><a href="https://bioconductor.org/packages/3.16/rhdf5" class="external-link">rhdf5</a></em> provides limited support for read-only access to HDF5 files stored in Amazon S3 buckets. This is implemented via the <a href="https://portal.hdfgroup.org/display/HDF5/Virtual+File+Drivers+-+S3+and+HDFS" class="external-link">HDF5 S3 Virtual File Driver</a> and allows access to HDF5 files hosted in both public and private S3 buckets.</p>
<p>Currently only the functions <code><a href="../reference/h5ls.html">h5ls()</a></code>, <code><a href="../reference/h5_dump.html">h5dump()</a></code> and <code><a href="../reference/h5_read.html">h5read()</a></code> are supported.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/grimbough/rhdf5" class="external-link">rhdf5</a></span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="public-s3-buckets">Public S3 Buckets<a class="anchor" aria-label="anchor" href="#public-s3-buckets"></a>
</h2>
<p>To access a file in a public Amazon S3 bucket you provide the file’s URL to the <code>file</code> argument. You also need to set the argument <code>s3 = TRUE</code>, otherwise <code><a href="../reference/h5ls.html">h5ls()</a></code> will treat the URL as a path on the local disk fail.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">public_S3_url</span> <span class="op">&lt;-</span> <span class="st">"https://rhdf5-public.s3.eu-central-1.amazonaws.com/h5ex_t_array.h5"</span>
<span class="fu"><a href="../reference/h5ls.html">h5ls</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">public_S3_url</span>,
     s3 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   group name       otype dclass dim</span>
<span class="co">## 0     /  DS1 H5I_DATASET  ARRAY   4</span></code></pre>
<p>The same arguments are also valid for using <code><a href="../reference/h5_dump.html">h5dump()</a></code> to retrieve the contents of a file.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">public_S3_url</span> <span class="op">&lt;-</span> <span class="st">"https://rhdf5-public.s3.eu-central-1.amazonaws.com/h5ex_t_cmpd.h5"</span>
<span class="fu"><a href="../reference/h5_dump.html">h5dump</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">public_S3_url</span>,
     s3 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $DS1</span>
<span class="co">##   Serial number          Location Temperature (F) Pressure (inHg)</span>
<span class="co">## 1          1153 Exterior (static)           53.23           24.57</span>
<span class="co">## 2          1184            Intake           55.12           22.95</span>
<span class="co">## 3          1027   Intake manifold          103.55           31.23</span>
<span class="co">## 4          1313  Exhaust manifold         1252.89           84.11</span></code></pre>
<p>In addition to examining and reading whole files, we can also extract just a subset, without needed to read or download the entire file. In the example below we use <code><a href="../reference/h5ls.html">h5ls()</a></code> to examine a file in an S3 bucket and identify the name of a dataset within it (<code>a1</code>) and the number of dimensions for that dataset (3). We can then use <code><a href="../reference/h5_read.html">h5read()</a></code> along with the <code>name</code> and <code>index</code> arguments to read only a subset of the dataset into our R session.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">public_S3_url</span> <span class="op">&lt;-</span> <span class="st">'https://rhdf5-public.s3.eu-central-1.amazonaws.com/rhdf5ex_t_float_3d.h5'</span>
<span class="fu"><a href="../reference/h5ls.html">h5ls</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">public_S3_url</span>, s3 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   group name       otype dclass        dim</span>
<span class="co">## 0     /   a1 H5I_DATASET  FLOAT 5 x 10 x 2</span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/h5_read.html">h5read</a></span><span class="op">(</span><span class="va">public_S3_url</span>, 
       name <span class="op">=</span> <span class="st">"a1"</span>, 
       index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="cn">NULL</span><span class="op">)</span>,
       s3 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## , , 1</span>
<span class="co">## </span>
<span class="co">##           [,1]</span>
<span class="co">## [1,] 0.2444485</span>
<span class="co">## [2,] 0.3873723</span>
<span class="co">## </span>
<span class="co">## , , 2</span>
<span class="co">## </span>
<span class="co">##           [,1]</span>
<span class="co">## [1,] 0.7906603</span>
<span class="co">## [2,] 0.3274960</span></code></pre>
</div>
<div class="section level2">
<h2 id="private-s3-buckets">Private S3 Buckets<a class="anchor" aria-label="anchor" href="#private-s3-buckets"></a>
</h2>
<p>To access files in a private Amazon S3 bucket you will need to provide three additional details: The AWS region where the files are hosted, your AWS access key ID, and your AWS secret access key. More information on how to obtain AWS access keys can be found under <a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys" class="external-link">AWS Security Credentials</a>.</p>
<p>These three values need to be stored in a list like below. <em>Important note: for now they must be in this specific order.</em></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## these are example credentials and will not work</span>
<span class="va">s3_cred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    aws_region <span class="op">=</span> <span class="st">"eu-central-1"</span>,
    access_key_id <span class="op">=</span> <span class="st">"AKIAIOSFODNN7EXAMPLE"</span>,
    secret_access_key <span class="op">=</span> <span class="st">"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"</span>
<span class="op">)</span></code></pre></div>
<p>Finally we pass this list to <code><a href="../reference/h5ls.html">h5ls()</a></code> via the <code>s3credentials</code> argument.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">public_S3_url</span> <span class="op">&lt;-</span> <span class="st">"https://rhdf5-private.s3.eu-central-1.amazonaws.com/h5ex_t_array.h5"</span>
<span class="fu"><a href="../reference/h5ls.html">h5ls</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">public_S3_url</span>,
     s3 <span class="op">=</span> <span class="cn">TRUE</span>,
     s3credentials <span class="op">=</span> <span class="va">s3_cred</span><span class="op">)</span></code></pre></div>
<p>The <code>s3credentials</code> arguments is used in exactly the same way for <code><a href="../reference/h5_dump.html">h5dump()</a></code> and <code><a href="../reference/h5_read.html">h5read()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## R version 4.2.0 (2022-04-22)</span>
<span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">## Running under: Ubuntu 20.04.4 LTS</span>
<span class="co">## </span>
<span class="co">## Matrix products: default</span>
<span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0</span>
<span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0</span>
<span class="co">## </span>
<span class="co">## locale:</span>
<span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span>
<span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span>
<span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span>
<span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span>
<span class="co">## </span>
<span class="co">## attached base packages:</span>
<span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">## </span>
<span class="co">## other attached packages:</span>
<span class="co">## [1] rhdf5_2.41.1     BiocStyle_2.24.0</span>
<span class="co">## </span>
<span class="co">## loaded via a namespace (and not attached):</span>
<span class="co">##  [1] knitr_1.39          magrittr_2.0.3      R6_2.5.1           </span>
<span class="co">##  [4] ragg_1.2.2          rlang_1.0.2         fastmap_1.1.0      </span>
<span class="co">##  [7] stringr_1.4.0       tools_4.2.0         xfun_0.31          </span>
<span class="co">## [10] cli_3.3.0           jquerylib_0.1.4     systemfonts_1.0.4  </span>
<span class="co">## [13] htmltools_0.5.2     yaml_2.3.5          digest_0.6.29      </span>
<span class="co">## [16] rprojroot_2.0.3     pkgdown_2.0.4       bookdown_0.27      </span>
<span class="co">## [19] textshaping_0.3.6   Rhdf5lib_1.18.2     BiocManager_1.30.18</span>
<span class="co">## [22] purrr_0.3.4         rhdf5filters_1.8.0  sass_0.4.1         </span>
<span class="co">## [25] fs_1.5.2            memoise_2.0.1       cachem_1.0.6       </span>
<span class="co">## [28] evaluate_0.15       rmarkdown_2.14      stringi_1.7.6      </span>
<span class="co">## [31] compiler_4.2.0      bslib_0.3.1         desc_1.4.1         </span>
<span class="co">## [34] jsonlite_1.8.0</span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bernd Fischer, Mike Smith, Gregoire Pau.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
