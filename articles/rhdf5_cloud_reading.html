<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reading HDF5 Files In The Cloud • rhdf5</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Reading HDF5 Files In The Cloud">
<meta property="og:description" content="rhdf5">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rhdf5</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.35.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/rhdf5.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/practical_tips.html">**rhdf5** Practical Tips</a>
    </li>
    <li>
      <a href="../articles/rhdf5_cloud_reading.html">Reading HDF5 Files In The Cloud</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/grimbough/rhdf5/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="rhdf5_cloud_reading_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Reading HDF5 Files In The Cloud</h1>
                        <h4 class="author">Mike L. Smith</h4>
            <address class="author_afil">
      de.NBI &amp; EMBL Heidelberg<br><small class="dont-index">Source: <a href="https://github.com/grimbough/rhdf5/blob/master/vignettes/rhdf5_cloud_reading.Rmd"><code>vignettes/rhdf5_cloud_reading.Rmd</code></a></small>
      <div class="hidden name"><code>rhdf5_cloud_reading.Rmd</code></div>

    </address>
</div>

    
    
<p>The <em><a href="https://bioconductor.org/packages/3.13/rhdf5">rhdf5</a></em> provides limited support for read-only access to HDF5 files stored in Amazon S3 buckets. This is implemented via the (HDF5 S3 Virtual File Driver)[<a href="https://portal.hdfgroup.org/display/HDF5/Virtual+File+Drivers+-+S3+and+HDFS" class="uri">https://portal.hdfgroup.org/display/HDF5/Virtual+File+Drivers+-+S3+and+HDFS</a>] and allows access to HDF5 files hosted in both public and private S3 buckets.</p>
<p>Currently only the functions <code><a href="../reference/h5ls.html">h5ls()</a></code>, <code><a href="../reference/h5ls.html">h5dump()</a></code> and <code><a href="../reference/h5write.html">h5read()</a></code> are supported.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/grimbough/rhdf5">rhdf5</a></span><span class="op">)</span></code></pre></div>
<div id="public-s3-buckets" class="section level1">
<h1 class="hasAnchor">
<a href="#public-s3-buckets" class="anchor"></a>Public S3 Buckets</h1>
<p>To access a file in a public Amazon S3 bucket you provide the file’s URL to the <code>file</code> argument. You also need to set the argument <code>s3 = TRUE</code>, otherwise <code><a href="../reference/h5ls.html">h5ls()</a></code> will treat the URL as a path on the local disk fail.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">public_S3_url</span> <span class="op">&lt;-</span> <span class="st">"https://rhdf5-public.s3.eu-central-1.amazonaws.com/h5ex_t_array.h5"</span>
<span class="fu"><a href="../reference/h5ls.html">h5ls</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">public_S3_url</span>,
     s3 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in H5Pset_fapl_ros3(fapl, s3credentials): Rhdf5lib was not compiled with support for the S3 VFD</code></pre>
<p>The same arguments are also valid for using <code><a href="../reference/h5ls.html">h5dump()</a></code> to retrieve the contents of a file.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">public_S3_url</span> <span class="op">&lt;-</span> <span class="st">"https://rhdf5-public.s3.eu-central-1.amazonaws.com/h5ex_t_cmpd.h5"</span>
<span class="fu"><a href="../reference/h5ls.html">h5dump</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">public_S3_url</span>,
     s3 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in H5Pset_fapl_ros3(fapl, s3credentials): Rhdf5lib was not compiled with support for the S3 VFD</code></pre>
<p>In addition to examining and reading whole files, we can also extract just a subset, without needed to read or download the entire file. In the example below we use <code><a href="../reference/h5ls.html">h5ls()</a></code> to examine a file in an S3 bucket and identify the name of a dataset within it (<code>a1</code>) and the number of dimensions for that dataset (3). We can then use <code><a href="../reference/h5write.html">h5read()</a></code> along with the <code>name</code> and <code>index</code> arguments to read only a subset of the dataset into our R session.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">public_S3_url</span> <span class="op">&lt;-</span> <span class="st">'https://rhdf5-public.s3.eu-central-1.amazonaws.com/rhdf5ex_t_float_3d.h5'</span>
<span class="fu"><a href="../reference/h5ls.html">h5ls</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">public_S3_url</span>, s3 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in H5Pset_fapl_ros3(fapl, s3credentials): Rhdf5lib was not compiled with support for the S3 VFD</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/h5write.html">h5read</a></span><span class="op">(</span><span class="va">public_S3_url</span>, 
       name <span class="op">=</span> <span class="st">"a1"</span>, 
       index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="cn">NULL</span><span class="op">)</span>,
       s3 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in H5Pset_fapl_ros3(fapl, s3credentials): Rhdf5lib was not compiled with support for the S3 VFD</code></pre>
</div>
<div id="private-s3-buckets" class="section level1">
<h1 class="hasAnchor">
<a href="#private-s3-buckets" class="anchor"></a>Private S3 Buckets</h1>
<p>To access files in a private Amazon S3 bucket you will need to provide three additional details: The AWS region where the files are hosted, your AWS access key ID, and your AWS secret access key. More information on how to obtain AWS access keys can be found under <a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys">AWS Security Credentials</a>.</p>
<p>These three values need to be stored in a list like below. <em>Important note: for now they must be in this specific order.</em></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## these are example credentials and will not work</span>
<span class="va">s3_cred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    aws_region <span class="op">=</span> <span class="st">"eu-central-1"</span>,
    access_key_id <span class="op">=</span> <span class="st">"AKIAIOSFODNN7EXAMPLE"</span>,
    secret_access_key <span class="op">=</span> <span class="st">"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"</span>
<span class="op">)</span></code></pre></div>
<p>Finally we pass this list to <code><a href="../reference/h5ls.html">h5ls()</a></code> via the <code>s3credentials</code> argument.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">public_S3_url</span> <span class="op">&lt;-</span> <span class="st">"https://rhdf5-private.s3.eu-central-1.amazonaws.com/h5ex_t_array.h5"</span>
<span class="fu"><a href="../reference/h5ls.html">h5ls</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">public_S3_url</span>,
     s3 <span class="op">=</span> <span class="cn">TRUE</span>,
     s3credentials <span class="op">=</span> <span class="va">s3_cred</span><span class="op">)</span></code></pre></div>
<p>The <code>s3credentials</code> arguments is used in exactly the same way for <code><a href="../reference/h5ls.html">h5dump()</a></code> and <code><a href="../reference/h5write.html">h5read()</a></code>.</p>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session Info</h1>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R version 4.1.0 RC (2021-05-10 r80282)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.7
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] rhdf5_2.35.5     BiocStyle_2.19.2
## 
## loaded via a namespace (and not attached):
##  [1] knitr_1.33          magrittr_2.0.1      R6_2.5.0           
##  [4] ragg_1.1.2          rlang_0.4.11        fastmap_1.1.0      
##  [7] stringr_1.4.0       tools_4.1.0         xfun_0.22          
## [10] jquerylib_0.1.4     htmltools_0.5.1.1   systemfonts_1.0.1  
## [13] yaml_2.2.1          digest_0.6.27       rprojroot_2.0.2    
## [16] pkgdown_1.6.1       crayon_1.4.1        bookdown_0.22      
## [19] textshaping_0.3.3   Rhdf5lib_1.13.7     BiocManager_1.30.15
## [22] rhdf5filters_1.3.5  sass_0.3.1          fs_1.5.0           
## [25] memoise_2.0.0       cachem_1.0.4        evaluate_0.14      
## [28] rmarkdown_2.8       stringi_1.5.3       compiler_4.1.0     
## [31] bslib_0.2.4         desc_1.3.0          jsonlite_1.7.2</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bernd Fischer, Mike Smith, Gregoire Pau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
